<%= content_tag(:a, "Add Trophy", class: "btn btn-primary mb-3", href: "/trophies/new") %>

<div class="tabnav">
  <nav class="tabnav-tabs">
    <% Competition.seasons_descending.each do |season| %>
      <% selected_tab_class = @season == season ? " selected" : "" %>
      <%= link_to season.description, trophies_by_season_path(season.to_param), class: "tabnav-tab#{selected_tab_class}" %>
    <% end %>
  </nav>
</div>

<%= form_tag nil, method: :get, class: "mb-4" do %>
  <%= select_tag :competition_id, options_from_collection_for_select(@competitions_in_season, :id, :name, params[:competition_id]), class: "form-select", onchange: "this.form.submit()", prompt: "All Competitions" %>
<% end %>

<%= form_tag nil, method: :get, class: "mb-4" do %>
  <%= select_tag :user_id, options_from_collection_for_select(@users, :id, :full_name, @user_id), class: "form-select", onchange: "this.form.submit()", prompt: "All Worts" %>
<% end %>

<table class="data-table width-full">
  <thead>
    <tr class="bg-gray">
      <td>Brewer</td>
      <td>Style</td>
      <td>Score</td>
      <td>Competition</td>
      <td>Place</td>
      <td>Links</td>
    </tr>
  </thead>
  <tbody>
    <% @trophies.each do |trophy| %>
      <tr id="trophy-<%= trophy.id %>">
        <td><%= trophy.user.full_name %></td>
        <td>
          <span class="Label Label--orange tooltipped tooltipped-e" aria-label="<%= trophy.subcategory_name %>">
            <%= trophy.subcategory_bjcp_id %>
          </span>
        </td>

        <td>
          <span class="Counter"><%= trophy.bjcp_score %></span>
        </td>

        <td>
          <%= link_to trophy.competition_url do %>
            <%= trophy.competition_name %>
          <% end %>
        </td>

        <td>
          <%= trophy.place_description %>
        </td>

        <td>
          <% if trophy.recipe_url.present? %>
            <%= link_to trophy.recipe_url do %>
              <%= octicon "file", height: 24 %>
            <% end %>
          <% end %>

          <% if trophy.photo.attached? %>
            <%= link_to url_for(trophy.photo) do %>
              <%= octicon "file-media", height: 24 %>
            <% end %>
          <% end %>

          <% if current_user&.can_edit?(trophy) %>
            <%= link_to edit_trophy_path(trophy), "aria-label": "Edit Trophy" do %>
              <%= octicon "pencil", height: 24 %>
            <% end %>
          <% end %>

          <% if current_user&.can_delete?(trophy) %>
            <%= link_to trophy_path(trophy), "aria-label": "Delete Trophy", method: :delete, data: { confirm: "Are you sure you want to delete this trophy?" } do %>
              <%= octicon "trashcan", height: 24 %>
            <% end %>
          <% end %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>
